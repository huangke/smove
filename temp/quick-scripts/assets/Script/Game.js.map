{"version":3,"sources":["Game.js"],"names":["Direction","require","BlockPool","BlockConfig","cc","Class","extends","Component","properties","scoreLabel","default","type","Label","playPrefab","Prefab","blockPrefab","bounsPrefab","centerNode","Node","startBtn","Button","_player","_bouns","playerRadius","blockRadius","_isStart","_dt","_touchPosX","_touchPosY","_isMoved","_cellsTable","onLoad","score","initCellsTable","initConfig","createPlayer","setTouchConstrol","node","on","onStartGame","xIndex","yIndex","i","j","index","x","y","push","forEach","log","element","instantiate","getComponent","_game","addChild","reset","createBonus","checkBonus","onCollect","addScore","string","toString","hideAllBlock","active","createBlock","gameOver","cacheAllBlock","destroy","stopAllActions","config","getBlockConfig","createOneBlock","point","speed","dir","getUpdateDelt","update","dt","startPos","block","create","event","getLocationX","getLocationY","touchDistance","pDistance","p","getLocation","disX","disY","right","up","Math","abs","down","left","changePos"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var Direction = require(\"direction\");\nvar BlockPool = require(\"BlockPool\");\nvar BlockConfig = require(\"BlockConfig\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel: {\n            default: null,\n            type: cc.Label\n        },\n        \n        playPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        blockPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        bounsPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        centerNode: {\n            default: null,\n            type: cc.Node\n        },\n        startBtn: {\n            default: null,\n            type: cc.Button\n        },\n\n        _player: null,\n        _bouns: null,\n        playerRadius: 80,\n        blockRadius: 80,\n        _isStart: false,\n        _dt: 0,\n\n        _touchPosX: 0,\n        _touchPosY: 0,\n        _isMoved: false,\n\n        _cellsTable:[],\n\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.score = 0;\n\n        this.initCellsTable();\n        BlockConfig.initConfig(this.centerNode);\n        this.createPlayer();\n        \n        this.setTouchConstrol();\n        this.startBtn.node.on(\"click\", this.onStartGame, this);\n    },\n\n    initCellsTable: function() {\n        var xIndex = [-1,0,1];\n        var yIndex = [1,0,-1];\n        for(var i = 0; i < 3; i++) {\n            for(var j = 0; j < 3; j++) {\n                var index = {x:xIndex[i], y:yIndex[j]};\n                this._cellsTable.push(index);\n            }\n        }\n        this._cellsTable.forEach(element => {\n            cc.log(\"index: %d,%d\",element.x,element.y);\n        });\n    },\n\n    createPlayer: function() {\n        if(!this._player) {\n            this._player = cc.instantiate(this.playPrefab);\n            this._player.getComponent(\"player\")._game = this;\n            this.node.addChild(this._player, 1);\n        }\n        this._player.getComponent(\"player\").reset();\n    },\n    \n    createBonus: function() {\n        this._bouns = cc.instantiate(this.bounsPrefab);\n        this._bouns.getComponent(\"Bonus\")._game = this;\n        this.node.addChild(this._bouns, 2);\n    },\n    \n    checkBonus: function() {\n        if (this._bouns) {\n            this._bouns.getComponent(\"Bonus\").onCollect();\n        }\n    },\n\n    addScore: function() {\n        this.score++;\n        this.scoreLabel.string = this.score.toString();\n    },\n\n    onStartGame: function() {\n        BlockPool.hideAllBlock();\n        this._isStart = true;\n        this._dt = 0;\n        this.startBtn.node.active = false;\n        \n        this._player.getComponent(\"player\").reset();\n        this.createBonus();\n        this.createBlock();\n    },\n\n    gameOver: function () {\n        BlockPool.cacheAllBlock();\n        this._isStart = false;\n        this.startBtn.node.active = true;\n        this.score = 0;\n        this.scoreLabel.string = \"\";\n        this._bouns.getComponent(\"Bonus\").node.destroy();\n        this._player.getComponent(\"player\").stopAllActions();\n    },\n\n    createBlock: function() {\n    \n        var config = BlockConfig.getBlockConfig(this.score);\n        this.createOneBlock(config[\"first\"].point, config[\"first\"].speed ,config[\"first\"].dir);\n        cc.log(\"first dir: \" + config[\"first\"].dir);\n        if (config[\"second\"]) {\n            this.createOneBlock(config[\"second\"].point, config[\"second\"].speed ,config[\"second\"].dir);\n            cc.log(\"second dir: \" + config[\"second\"].dir);\n        }\n    },\n\n    getUpdateDelt: function() {\n        if (this.score <= 10) {\n            return 2;\n        } else if (this.score <= 20) {\n            return 1.7;\n        } else if (this.score <= 30) {\n            return 1.5;\n        } else if (this.score <= 40) {\n            return 1.2\n        }\n        return 1;\n    },\n    // called every frame\n    update: function (dt) {\n        if(this._isStart == true) {\n            this._dt += dt;\n            if(this._dt >= this.getUpdateDelt()) {\n                this._dt = 0;\n                this.createBlock();\n            }\n        }\n    },\n\n    createOneBlock: function(startPos, speed, dir) {\n        var block = BlockPool.createBlock(this.blockPrefab, this);\n        block.create(startPos,speed, dir, this);\n    },\n\n    setTouchConstrol: function() {\n        this.node.on('touchstart', function (event) {\n            this._touchPosX = event.getLocationX();\n            this._touchPosY = event.getLocationY();\n            this._isMoved = false;\n        }, this);\n        this.node.on('touchmove', function (event) {\n            if(this._isMoved) {\n                return;\n            }\n            var touchDistance = cc.pDistance(cc.p(this._touchPosX,this._touchPosY), event.getLocation());\n            var disX = event.getLocationX() - this._touchPosX;\n            var disY = event.getLocationY() - this._touchPosY;\n            var dir = -1;\n            if(touchDistance >= 10) {\n                if(disX > 0 && disY > 0) {\n                    if(disX > disY) {\n                        dir = Direction.right;\n                    } else {\n                        dir = Direction.up;\n                    }\n                } else if (disX > 0 && disY < 0) {\n                    if(Math.abs(disX) > Math.abs(disY)) {\n                        dir = Direction.right;\n                    } else {\n                        dir = Direction.down;\n                    }\n                } else if(disX < 0 && disY < 0) {\n                    if(Math.abs(disX) > Math.abs(disY)) {\n                        dir = Direction.left;\n                    } else {\n                        dir = Direction.down;\n                    }\n                } else if(disX < 0 && disY > 0) {\n                    if(Math.abs(disX) > Math.abs(disY)) {\n                        dir = Direction.left;\n                    } else {\n                        dir = Direction.up;\n                    }\n                } else if(disX == 0 && disY > 0) {\n                    dir = Direction.up;\n                } else if(disX == 0 && disY < 0) {\n                    dir = Direction.down;\n                } else if(disX > 0 && disY == 0) {\n                    dir = Direction.right;\n                } else if(disX < 0 && disY == 0) {\n                    dir = Direction.left;\n                }\n                this._player.getComponent('player').changePos(dir);\n                this._isMoved = true;\n            }\n        }, this);\n    }\n});\n"]}