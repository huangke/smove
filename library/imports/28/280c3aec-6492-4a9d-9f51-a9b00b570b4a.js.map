{"version":3,"sources":["../../../../assets/Script/assets/Script/HelloWorld.js"],"names":["Direction","require","BlockPool","cc","Class","extends","Component","properties","playPrefab","default","type","Prefab","blockPrefab","centerNode","Node","startBtn","Button","_player","playerRadius","blockRadius","_blockPool","_isStart","_dt","_touchPosX","_touchPosY","_isMoved","onLoad","instantiate","getComponent","_game","node","addChild","setTouchConstrol","on","onStartGame","hideAllBlock","createBlock","active","setPosition","p","gameOver","cacheAllBlock","stopAllActions","getRandom","randomRange","lastRandom","random","rand","ret","Math","round","dir","down","x","y","winSize","height","up","right","width","left","dirTab","first","second","createOneBlock","log","update","dt","startPos","speed","block","create","event","getLocationX","getLocationY","touchDistance","pDistance","getLocation","disX","disY","abs","changePos"],"mappings":"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","file":"HelloWorld.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var Direction = require(\"direction\");\nvar BlockPool = require(\"BlockPool\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // label: {\n        //     default: null,\n        //     type: cc.Label\n        // },\n        // defaults, set visually when attaching this script to the Canvas\n        playPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        blockPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        centerNode: {\n            default: null,\n            type: cc.Node\n        },\n        startBtn: {\n            default: null,\n            type: cc.Button\n        },\n\n        _player: null,\n        playerRadius: 80,\n        blockRadius: 80,\n        _blockPool: null,\n        _isStart: false,\n        _dt: 0,\n\n        _touchPosX: 0,\n        _touchPosY: 0,\n        _isMoved: false\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._player = cc.instantiate(this.playPrefab);\n        this._player.getComponent(\"player\")._game = this;\n        this.node.addChild(this._player);\n        this.setTouchConstrol();\n        this.startBtn.node.on(\"click\", this.onStartGame, this);\n    },\n\n    onStartGame: function() {\n        BlockPool.hideAllBlock();\n        this._isStart = true;\n        this._dt = 0;\n        this.createBlock();\n        this.startBtn.node.active = false;\n        if(this._player) {\n            this._player.setPosition(cc.p(0, 0));\n        }\n    },\n\n    gameOver: function () {\n        BlockPool.cacheAllBlock();\n        this._isStart = false;\n        this.startBtn.node.active = true;\n\n        this._player.getComponent(\"player\").stopAllActions();\n    },\n\n    getRandom: function(randomRange, lastRandom) {\n        var random = cc.rand();\n        var ret = Math.round(random) % randomRange;\n        if(lastRandom && lastRandom == ret) {\n            return this.getRandom(randomRange, lastRandom);\n        }\n        return ret;\n    },\n\n    createBlock: function() {\n        var random = cc.rand();\n        var dir = Math.round(random) % 4;\n        var down = [cc.p(this.centerNode.x - 80,this.centerNode.y + cc.winSize.height/2 + 40),cc.p(this.centerNode.x,this.centerNode.y + cc.winSize.height/2 + 40),cc.p(this.centerNode.x + 80,this.centerNode.y + cc.winSize.height/2 + 40)];\n        var up = [cc.p(this.centerNode.x - 80,this.centerNode.y - cc.winSize.height/2 - 40),cc.p(this.centerNode.x,this.centerNode.y - cc.winSize.height/2 - 40),cc.p(this.centerNode.x + 80,this.centerNode.y - cc.winSize.height/2 - 40)];\n        var right = [cc.p(this.centerNode.x - cc.winSize.width/2 - 40,this.centerNode.y),cc.p(this.centerNode.x - cc.winSize.width/2 - 40,this.centerNode.y + 80),cc.p(this.centerNode.x - cc.winSize.width/2 - 40,this.centerNode.y - 80)];\n        var left = [cc.p(this.centerNode.x + cc.winSize.width/2 + 40,this.centerNode.y),cc.p(this.centerNode.x + cc.winSize.width/2 + 40,this.centerNode.y + 80),cc.p(this.centerNode.x + cc.winSize.width/2 + 40,this.centerNode.y - 80)];\n        var dirTab = [];\n        switch(dir){\n            case Direction.left:\n                dirTab = left;\n            break;\n            case Direction.right:\n                dirTab = right;\n            break;\n            case Direction.up:\n                dirTab = up;\n            break;\n            case Direction.down:\n                dirTab = down;\n            break;\n        }\n        var first = this.getRandom(3);\n        var second = this.getRandom(3, first);\n        this.createOneBlock(dirTab[first], 5 ,dir);\n        this.createOneBlock(dirTab[second], 5 ,dir);\n        cc.log(\"first: \" + first + \" second: \" + second);\n    },\n\n    // called every frame\n    update: function (dt) {\n        if(this._isStart == true) {\n            this._dt += dt;\n            if(this._dt >= 2) {\n                this._dt = 0;\n                this.createBlock();\n            }\n        }\n    },\n\n    createOneBlock: function(startPos, speed, dir) {\n        var block = BlockPool.createBlock(this.blockPrefab, this);\n        block.create(startPos,speed, dir, this);\n    },\n\n    setTouchConstrol: function() {\n        this.node.on('touchstart', function (event) {\n            this._touchPosX = event.getLocationX();\n            this._touchPosY = event.getLocationY();\n            this._isMoved = false;\n        }, this);\n        this.node.on('touchmove', function (event) {\n            if(this._isMoved) {\n                return;\n            }\n            var touchDistance = cc.pDistance(cc.p(this._touchPosX,this._touchPosY), event.getLocation());\n            var disX = event.getLocationX() - this._touchPosX;\n            var disY = event.getLocationY() - this._touchPosY;\n            var dir = -1;\n            if(touchDistance >= 10) {\n                if(disX > 0 && disY > 0) {\n                    if(disX > disY) {\n                        dir = Direction.right;\n                    } else {\n                        dir = Direction.up;\n                    }\n                } else if (disX > 0 && disY < 0) {\n                    if(Math.abs(disX) > Math.abs(disY)) {\n                        dir = Direction.right;\n                    } else {\n                        dir = Direction.down;\n                    }\n                } else if(disX < 0 && disY < 0) {\n                    if(Math.abs(disX) > Math.abs(disY)) {\n                        dir = Direction.left;\n                    } else {\n                        dir = Direction.down;\n                    }\n                } else if(disX < 0 && disY > 0) {\n                    if(Math.abs(disX) > Math.abs(disY)) {\n                        dir = Direction.left;\n                    } else {\n                        dir = Direction.up;\n                    }\n                } else if(disX == 0 && disY > 0) {\n                    dir = Direction.up;\n                } else if(disX == 0 && disY < 0) {\n                    dir = Direction.down;\n                } else if(disX > 0 && disY == 0) {\n                    dir = Direction.right;\n                } else if(disX < 0 && disY == 0) {\n                    dir = Direction.left;\n                }\n                this._player.getComponent('player').changePos(dir);\n                this._isMoved = true;\n            }\n        }, this);\n    },\n\n});\n"]}